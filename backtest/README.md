# MCI価格予想バックテストツール

第8章の価格予想原理に基づく月次バックテストツール群

## ファイル構成

### 1. バックテストツール

#### `backtest_monthly_prediction.py`
指定月のデータから翌月の価格を予想し、実績と比較するツール

**使い方：**
```bash
# デフォルト（参照シナリオ: 2025-10→2025-11）
python backtest_monthly_prediction.py --base-month 2025-02

# カスタム参照期間を指定
python backtest_monthly_prediction.py --base-month 2024-08 --reference-month 2024-07
```

**出力例：**
```
| 通貨ペア | 中心シナリオ | リスクレンジ | 実績値 | 誤差率 |
|---------|-------------|-------------|--------|--------|
| USD/JPY | 148〜153円 | 146〜161円 | 149円 | +0.88% |
| USD/TRY | 36.4〜37.0リラ | 34.8〜38.5リラ | 37.09リラ | -1.05% |
| TRY/JPY | 4.01〜4.19円 | 3.98〜4.40円 | 4.02円 | +1.94% |
```

#### `run_comprehensive_backtest.py`
全期間（2022-01〜2025-10）のバックテストを実行し、結果をCSVに出力

**使い方：**
```bash
# デフォルト出力: backtest_results_2022_2025.csv
python run_comprehensive_backtest.py

# カスタム出力ファイル
python run_comprehensive_backtest.py --output my_results.csv
```

**出力内容：**
- 45ヶ月分の予想結果
- 各通貨ペアの中心シナリオ・リスクレンジ・実績値・誤差率

### 2. 分析ツール

#### `analyze_backtest_results.py`
バックテスト結果の詳細分析（的中率、誤差分布、外れた月の特徴など）

**使い方：**
```bash
# 全期間の分析
python analyze_backtest_results.py

# 2023年8月以降のみ分析（安定期）
python analyze_backtest_results.py 2023-08
```

**出力内容：**
- レンジ的中率（中心シナリオ・リスクレンジ）
- 誤差分布（0-1%, 1-2%, 2-3%, ...）
- 最も外れた予想Top 5
- 総合評価

#### `analyze_range_width.py`
中心シナリオとリスクレンジの幅を比較分析

**使い方：**
```bash
python analyze_range_width.py
```

**出力内容：**
- 中心シナリオの平均幅
- リスクレンジの平均幅
- 幅の比率と的中率の関係

### 3. バックテスト結果データ

#### `backtest_results_2022_2025.csv`
全期間（2022-01〜2025-10）のバックテスト結果

**列構成：**
- `base_month`: 基準月
- `target_month`: 予想対象月
- `ref_month`: 参照シナリオ月
- 各通貨ペア（USDJPY, USDTRY, TRYJPY）ごとに：
  - `pred_center_min/max/mid`: 中心シナリオ
  - `pred_risk_lower/upper`: リスクレンジ
  - `actual`: 実績値
  - `error_pct`: 誤差率（%）

## 予想手法

### シナリオ生成
参照期間（前月→基準月）の変化量から3つのシナリオを生成：

- **シナリオA（慣性維持）**: 実際の変化量をそのまま適用
- **シナリオB（やや円高）**: USD強化、JPY調整、TRY抑制
- **シナリオC（やや円安）**: USD抑制、JPY調整、TRY維持

### 価格計算
各シナリオのMCI座標から為替レートを計算：

```
S_{A/B} = PPP_{A/B} × exp(m[A] - m[B])
```

### レンジ設定

- **中心シナリオ**: 3シナリオの最小値〜最大値
- **リスクレンジ**: 中心±5.13%（月次変動±0.05を考慮）

## バックテスト結果サマリー

### 全期間（2022-01〜2025-10、45ヶ月）

- **中心シナリオ的中率**: 40-44%
- **リスクレンジ的中率**: 82-89%
- **平均絶対誤差**: 2.3-3.1%
- **最大誤差**: 6.98-13.38%

### 安定期（2023-08〜2025-11、28ヶ月）

- **中心シナリオ的中率**: 44%
- **リスクレンジ的中率**: 89%（USD/TRY: 96%）
- **平均絶対誤差**: 1.85-2.77%
- **最大誤差**: 6.98-8.72%

### 重要な発見

1. **リスクレンジの信頼性**
   - 中心シナリオ幅: 価格の±1-3%
   - リスクレンジ幅: 価格の±5%
   - **わずか数%広げるだけで的中率が2倍以上に**

2. **政治イベントの影響**
   - 2023年6-7月（トルコ大統領選挙）で大きく外れる
   - 安定期を分析すると精度が向上

3. **実用性評価**
   - 中心シナリオ: 参考程度（半分外れる）
   - リスクレンジ: リスク管理ツールとして使用可能
   - 政治的混乱期を除けば「やや良好」な精度

## データソース

バックテストは以下のデータを使用：
- **CSV**: `../dataset/monthly_mci_interpolated_ppp_2022_2025.csv`
- **PPP**: 年次PPPを月次で線形補間（実験的）
- **為替レート**: IMF IFS月次平均レート
- **期間**: 2022-01〜2025-11（47ヶ月）

## 注意事項

- 2025年のPPPはIMF WEO October 2025の投影値を使用（確定値は2026年10月公表予定）
- 月次平均レートを使用しているため、月内の急激な変動は捉えられない
- 政治イベント等の突発的要因による変動は予測困難
- あくまで統計的・理論的アプローチであり、実際の取引判断には追加分析が必要

## 今後の改善案

1. **シナリオ設定の最適化**: A/B/Cの係数をデータから最適化
2. **参照期間の選択**: 固定参照期間 vs 直前月参照の比較
3. **季節性の考慮**: 月ごとの変動パターンを考慮
4. **外部要因の組み込み**: 金利差、インフレ率、政治イベント等
5. **動的PPP推定**: 月次PPPをより正確に推定

---

**作成日**: 2025-12-01
**論文参照**: `../docs/FULL_PAPER_CORRECTED.md` 第8章
